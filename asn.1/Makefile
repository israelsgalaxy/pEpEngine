# Copyright 2017, pEp Foundation
# This file is part of pEpEngine
# This file may be used under the terms of the GNU General Public License version 3
# see LICENSE.txt

include ../Makefile.conf

ALL_SOURCE=$(wildcard *.c)
ALL_OBJECTS=$(subst .c,.o,$(ALL_SOURCE))

libasn1.a: $(ALL_OBJECTS)
	ar -rc $@ $^

.PHONY: generate
generate: Sync-Protocols.c
	# "converter-sample.c" is the example file containing a "main()" function generated by ans1c.
	rm -f converter-sample.c

%.o: %.c %.h
	# '-Wno-cpp' is required to suppress the warning "_BSD_SOURCE and _SVID_SOURCE are deprecated, use _DEFAULT_SOURCE" otherwise printed during the compilation of every asn1c-generated C file.
	$(CC) $(CFLAGS) -Wno-cpp -I. $(ASN1C_INC) -c $< -o $@

Sync-Protocols.c: pEp.asn1 devicegroup.asn1 protocols.asn1
	$(ASN1C) -gen-PER -fincludes-quoted -fcompound-names -pdu=PEP.Message $^

.PHONY: clean
clean:
	rm -f *.a *.o *.c *.h *.sample

.PHONY: install
install: libasn1.a
	cp $< $(PREFIX)/lib/

.PHONY: uninstall
uninstall:
	rm -f $(PREFIX)/lib/libasn1.a
